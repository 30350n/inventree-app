# Run flutter linting checks

name: test

on:
  push:
    branches:
      - master
  pull_request:
    branches:
      - master

jobs:

  lint:
    runs-on: ubuntu-latest

    env:
      SENTRY_DSN: ${{ secrets.SENTRY_DSN }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          submodules: recursive
      - name: Setup Java
        uses: actions/setup-java@v1
        with:
          java-version: '12.x'
      - name: Setup Flutter 
        uses: subosito/flutter-action@v1
        with:
          flutter-version: '2.10.3'
      - run: flutter pub get
      - run: cp lib/dummy_dsn.dart lib/dsn.dart
      - run: flutter analyze
      - run: flutter test --coverage

  android:
   runs-on: macos-latest
  
   steps:
     - name: Checkout code
       uses: actions/checkout@v2
       with:
         submodules: recursive
     - name: Setup Java
       uses: actions/setup-java@v1
       with:
         java-version: '12.x'
     - name: Setup Flutter
       uses: subosito/flutter-action@v1
       with:
         flutter-version: '2.10.3'
     - name: Setup Gradle
       uses: gradle/gradle-build-action@v2
       with:
         gradle-version: 6.1.1
     - run: flutter pub get
     - run: cp lib/dummy_dsn.dart lib/dsn.dart
     - run: flutter build apk --debug
  
  #ios:
  #  runs-on: macos-latest
  #
  #  steps:
  #  - name: Checkout code
  #    uses: actions/checkout@v2
  #    with:
  #      submodules: recursive
  #  - name: Setup Java
  #    uses: actions/setup-java@v1
  #    with:
  #      java-version: '12.x'
  #  - name: Setup Flutter
  #    uses: subosito/flutter-action@v1
  #    with:
  #      flutter-version: '2.2.3'
  #  - run: flutter pub get
  #  - run: cp lib/dummy_dsn.dart lib/dsn.dart
  #  - run: flutter build ios --release --no-codesign
